# Fix Railway Database Connection

## üö® Current Issue
Contact forms submit successfully (HTTP 200) but data is not persisting to the Railway PostgreSQL database.

## üîç Root Cause Analysis
The Railway application is likely not using the correct database configuration. Here are the steps to fix it:

## ‚úÖ Step 1: Verify Railway Environment Variables

Go to your Railway dashboard at: https://railway.app/dashboard
Find your project and check these environment variables:

### Required Environment Variables:
```bash
# CRITICAL: Set the Spring profile to use railway configuration
SPRING_PROFILES_ACTIVE=railway

# JWT Configuration
JWT_SECRET=Bqe5Zevcwc4pCjuxviUf5bhHeYHVCbF9/pvgLM4vQ84=
JWT_EXPIRATION=86400000

# Email Configuration
MAIL_USERNAME=adityamalik5763@gmail.com
MAIL_PASSWORD=bsys ifpg gpof dfcm
MAIL_FROM=adityamalik5763@gmail.com
ADMIN_EMAIL=adityamalik2206950100018@gmail.com

# Frontend URL
FRONTEND_URL=https://zpluse.com

# Upload Directory
UPLOAD_DIR=/tmp/uploads

# Server Port
PORT=8080
```

### Database Environment Variables:
Railway should automatically provide:
- `DATABASE_URL` - This is automatically generated by Railway PostgreSQL service

## ‚úÖ Step 2: Verify Railway PostgreSQL Service

1. Go to Railway Dashboard ‚Üí Your Project
2. Make sure you have a PostgreSQL service added
3. Check that the PostgreSQL service is running (green status)
4. The `DATABASE_URL` should be automatically available

## ‚úÖ Step 3: Test Database Connection

After setting the environment variables, test the connection:

```bash
# Test basic endpoint
curl https://z-management-production.up.railway.app/public/contact/test

# Test contact form submission
curl -X POST https://z-management-production.up.railway.app/public/contact/submit \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "phone": "1234567890",
    "subject": "Test Subject",
    "message": "This is a test message"
  }'
```

## ‚úÖ Step 4: Check Railway Logs

1. Go to Railway Dashboard ‚Üí Deployments ‚Üí View Logs
2. Look for these log messages:
   - Spring profile activation: "The following profiles are active: railway"
   - Database connection: "HikariPool-1 - Starting..."
   - SQL queries being executed

## ‚úÖ Step 5: Verify Configuration Files

Our application now has the correct configuration:

### application-railway.yml:
- Uses `DATABASE_URL` environment variable
- Enabled detailed logging
- Correct PostgreSQL dialect

## üîß Quick Fix Commands

If the environment variables are missing, set them in Railway:

1. **Most Important**: Set `SPRING_PROFILES_ACTIVE=railway`
2. Add the other environment variables listed above
3. Redeploy the application

## üéØ Expected Result

After fixing the environment variables:
- Contact form should submit successfully (HTTP 200)
- Data should appear in the database
- Admin panel should show the submitted contact inquiries
- Railway logs should show SQL INSERT statements

## üÜò If Still Not Working

Check these additional items:
1. Railway PostgreSQL service status
2. Database connectivity from Railway application
3. Check if tables are being created properly
4. Verify the DATABASE_URL format

## üìû Next Steps

1. Set the environment variables in Railway
2. Wait for automatic redeployment
3. Test the contact form again
4. Check Railway logs for detailed information

The key missing piece is likely the `SPRING_PROFILES_ACTIVE=railway` environment variable!
